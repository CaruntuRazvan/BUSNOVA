-- BUSNOVA (Companie Transport)
-- ============================================

DROP TABLE Pret_Segment;
DROP TABLE Plata;
DROP TABLE Rezervare;
DROP TABLE Mentenanta;
DROP TABLE Cursa;
DROP TABLE Ruta_Statie;
DROP TABLE Autobuz_Dotare;
DROP TABLE Client;
DROP TABLE Sofer;
DROP TABLE Statie;
DROP TABLE Ruta;
DROP TABLE Autobuz;
DROP TABLE Dotare;
DROP TABLE Producator; 


-- Producatori 
CREATE TABLE Producator (
    producator_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    nume_producator VARCHAR2(100) NOT NULL UNIQUE,
    tara_producator VARCHAR2(50)
);


-- Dotari
CREATE TABLE Dotare (
    dotare_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    nume_dotare VARCHAR2(50) NOT NULL UNIQUE
);

-- Autobuze
CREATE TABLE Autobuz (
    autobuz_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    producator_id NUMBER NOT NULL,
    nr_inmatriculare VARCHAR2(20) UNIQUE NOT NULL,
    marca VARCHAR2(50),
    model VARCHAR2(50),
    an_fabricatie NUMBER(4),
    total_locuri NUMBER NOT NULL,
    status VARCHAR2(20) DEFAULT 'activ',
    CONSTRAINT fk_autobuz_producator FOREIGN KEY (producator_id) REFERENCES Producator(producator_id)
);

-- Legatura Autobuz - Dotari (Relație M:N)
CREATE TABLE Autobuz_Dotare (
    autobuz_id NUMBER NOT NULL,
    dotare_id NUMBER NOT NULL,
    CONSTRAINT pk_autobuz_dotare PRIMARY KEY (autobuz_id, dotare_id),
    CONSTRAINT fk_ad_autobuz FOREIGN KEY (autobuz_id) REFERENCES Autobuz(autobuz_id) ON DELETE CASCADE,
    CONSTRAINT fk_ad_dotare FOREIGN KEY (dotare_id) REFERENCES Dotare(dotare_id) ON DELETE CASCADE
);

-- Soferi
CREATE TABLE Sofer (
    sofer_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    nume VARCHAR2(50) NOT NULL,
    prenume VARCHAR2(50) NOT NULL,
    telefon VARCHAR2(20),
    email VARCHAR2(100),
    nr_licenta VARCHAR2(30) UNIQUE,
    valabilitate_licenta DATE,
    status_angajare VARCHAR2(20) DEFAULT 'activ'
);

-- Statii
CREATE TABLE Statie (
    statie_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    nume VARCHAR2(100) NOT NULL,
    oras VARCHAR2(50) NOT NULL,
    tara VARCHAR2(50),
    adresa VARCHAR2(150),
    latitudine NUMBER(9,6),
    longitudine NUMBER(9,6)
);

-- Rute
CREATE TABLE Ruta (
    ruta_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    nume_ruta VARCHAR2(100) NOT NULL,
    distanta_km NUMBER,
    durata_estimata_minute NUMBER,
    activ CHAR(1) DEFAULT 'Y'
);

-- Statii per Ruta
CREATE TABLE Ruta_Statie (
    ruta_statie_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ruta_id NUMBER NOT NULL,
    statie_id NUMBER NOT NULL,
    ordine_oprire NUMBER NOT NULL,
    minute_sosire_offset NUMBER,
    minute_plecare_offset NUMBER,
    CONSTRAINT fk_rs_ruta FOREIGN KEY (ruta_id) REFERENCES Ruta(ruta_id) ON DELETE CASCADE,
    CONSTRAINT fk_rs_statie FOREIGN KEY (statie_id) REFERENCES Statie(statie_id) ON DELETE CASCADE
);

-- Curse 
CREATE TABLE Cursa (
    cursa_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ruta_id NUMBER,
    autobuz_id NUMBER,
    sofer_id NUMBER,
    data_ora_plecare TIMESTAMP NOT NULL,
    data_ora_sosire_estimata TIMESTAMP,
    status VARCHAR2(20) DEFAULT 'planificata',
    CONSTRAINT fk_cursa_ruta FOREIGN KEY (ruta_id) REFERENCES Ruta(ruta_id),
    CONSTRAINT fk_cursa_autobuz FOREIGN KEY (autobuz_id) REFERENCES Autobuz(autobuz_id),
    CONSTRAINT fk_cursa_sofer FOREIGN KEY (sofer_id) REFERENCES Sofer(sofer_id)
);

-- Clienti
CREATE TABLE Client (
    client_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    nume_complet VARCHAR2(100) NOT NULL,
    email VARCHAR2(100),
    telefon VARCHAR2(20),
    data_creare TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Rezervari
CREATE TABLE Rezervare (
    rezervare_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    client_id NUMBER NOT NULL,
    cursa_id NUMBER NOT NULL,
    nr_loc NUMBER NOT NULL,
    statie_plecare_id NUMBER NOT NULL,
    statie_sosire_id NUMBER NOT NULL,
    pret NUMBER(10,2),
    status VARCHAR2(20) DEFAULT 'rezervat',
    data_rezervare TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_rez_client FOREIGN KEY (client_id) REFERENCES Client(client_id),
    CONSTRAINT fk_rez_cursa FOREIGN KEY (cursa_id) REFERENCES Cursa(cursa_id),
    CONSTRAINT fk_rez_plecare FOREIGN KEY (statie_plecare_id) REFERENCES Statie(statie_id),
    CONSTRAINT fk_rez_sosire FOREIGN KEY (statie_sosire_id) REFERENCES Statie(statie_id),
    CONSTRAINT uniq_cursa_loc UNIQUE (cursa_id, nr_loc)
);

-- 11. Plati
CREATE TABLE Plata (
    plata_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    rezervare_id NUMBER NOT NULL,
    suma NUMBER(10,2),
    metoda_plata VARCHAR2(20),
    status VARCHAR2(20) DEFAULT 'succes',
    data_plata TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_plata_rezervare FOREIGN KEY (rezervare_id) REFERENCES Rezervare(rezervare_id)
);

-- 12. Mentenanta
CREATE TABLE Mentenanta (
    mentenanta_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    autobuz_id NUMBER NOT NULL,
    tip_mentenanta VARCHAR2(50),
    descriere CLOB,
    data_inceput DATE,
    data_sfarsit DATE,
    cost NUMBER(10,2),
    efectuata_de VARCHAR2(100),
    CONSTRAINT fk_ment_autobuz FOREIGN KEY (autobuz_id) REFERENCES Autobuz(autobuz_id)
);

-- 13. Prețuri Segmente Ruta
CREATE TABLE Pret_Segment (
    segment_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ruta_id NUMBER NOT NULL,
    statie_plecare_id NUMBER NOT NULL,
    statie_sosire_id NUMBER NOT NULL,
    pret_baza NUMBER(10,2) NOT NULL,
    CONSTRAINT fk_seg_ruta FOREIGN KEY (ruta_id) REFERENCES Ruta(ruta_id),
    CONSTRAINT fk_seg_plecare FOREIGN KEY (statie_plecare_id) REFERENCES Statie(statie_id),
    CONSTRAINT fk_seg_sosire FOREIGN KEY (statie_sosire_id) REFERENCES Statie(statie_id),
    CONSTRAINT uniq_segment UNIQUE (ruta_id, statie_plecare_id, statie_sosire_id)
);


-- INSERT-URI
-- PRODUCATORI
INSERT INTO Producator (nume_producator, tara_producator) VALUES ('Mercedes-Benz', 'Germania');
INSERT INTO Producator (nume_producator, tara_producator) VALUES ('Setra', 'Germania');
INSERT INTO Producator (nume_producator, tara_producator) VALUES ('Iveco', 'Italia');
INSERT INTO Producator (nume_producator, tara_producator) VALUES ('Isuzu', 'Turcia');
INSERT INTO Producator (nume_producator, tara_producator) VALUES ('Volvo', 'Suedia');

-- DOTARI
INSERT INTO Dotare (nume_dotare) VALUES ('Wi-Fi');
INSERT INTO Dotare (nume_dotare) VALUES ('Aer Conditionat');
INSERT INTO Dotare (nume_dotare) VALUES ('Prize USB');
INSERT INTO Dotare (nume_dotare) VALUES ('Toaleta');
INSERT INTO Dotare (nume_dotare) VALUES ('Scaune Reclinabile');

-- SOFERI
INSERT INTO Sofer (nume, prenume, nr_licenta) VALUES ('Popescu', 'Ion', 'LIC001');
INSERT INTO Sofer (nume, prenume, nr_licenta) VALUES ('Dumitru', 'Gheorghe', 'LIC002');
INSERT INTO Sofer (nume, prenume, nr_licenta) VALUES ('Ionescu', 'Vasile', 'LIC003');
INSERT INTO Sofer (nume, prenume, nr_licenta) VALUES ('Stan', 'Andrei', 'LIC004');
INSERT INTO Sofer (nume, prenume, nr_licenta) VALUES ('Radu', 'Mihai', 'LIC005');

-- STATII 
INSERT INTO Statie (nume, oras, tara) VALUES ('Autogara Codreanu', 'Iasi', 'Romania');      -- ID 1
INSERT INTO Statie (nume, oras, tara) VALUES ('Autogara Focsani', 'Focsani', 'Romania');    -- ID 2
INSERT INTO Statie (nume, oras, tara) VALUES ('Autogara Buzau', 'Buzau', 'Romania');        -- ID 3
INSERT INTO Statie (nume, oras, tara) VALUES ('Autogara Militari', 'Bucuresti', 'Romania'); -- ID 4
INSERT INTO Statie (nume, oras, tara) VALUES ('Autogara Ploiesti', 'Ploiesti', 'Romania');  -- ID 5
INSERT INTO Statie (nume, oras, tara) VALUES ('Autogara Bartolomeu', 'Brasov', 'Romania');  -- ID 6
INSERT INTO Statie (nume, oras, tara) VALUES ('Autogara Vest', 'Sibiu', 'Romania');         -- ID 7
INSERT INTO Statie (nume, oras, tara) VALUES ('Autogara Deva', 'Deva', 'Romania');          -- ID 8

-- RUTE
INSERT INTO Ruta (nume_ruta, distanta_km) VALUES ('Iasi - Focsani - Buzau - Bucuresti', 400); -- ID 1
INSERT INTO Ruta (nume_ruta, distanta_km) VALUES ('Bucuresti - Ploiesti', 60);               -- ID 2
INSERT INTO Ruta (nume_ruta, distanta_km) VALUES ('Bucuresti - Brasov', 170);                -- ID 3
INSERT INTO Ruta (nume_ruta, distanta_km) VALUES ('Brasov - Sibiu - Deva', 220);             -- ID 4
INSERT INTO Ruta (nume_ruta, distanta_km) VALUES ('Cluj - Sibiu', 170);                      -- ID 5

-- CLIENTI
INSERT INTO Client (nume_complet, email) VALUES ('Marian Vasile', 'marian@mail.ro');
INSERT INTO Client (nume_complet, email) VALUES ('Ioana Radu', 'ioana@mail.ro');
INSERT INTO Client (nume_complet, email) VALUES ('Elena Vasilescu', 'elena@mail.ro');
INSERT INTO Client (nume_complet, email) VALUES ('Cristian Badea', 'cristi@mail.ro');
INSERT INTO Client (nume_complet, email) VALUES ('Andra Stoica', 'andra@mail.ro');


-- RUTA_STATIE
INSERT INTO Ruta_Statie (ruta_id, statie_id, ordine_oprire) VALUES (1, 1, 1); -- Iasi
INSERT INTO Ruta_Statie (ruta_id, statie_id, ordine_oprire) VALUES (1, 2, 2); -- Focsani
INSERT INTO Ruta_Statie (ruta_id, statie_id, ordine_oprire) VALUES (1, 3, 3); -- Buzau
INSERT INTO Ruta_Statie (ruta_id, statie_id, ordine_oprire) VALUES (1, 4, 4); -- Bucuresti
INSERT INTO Ruta_Statie (ruta_id, statie_id, ordine_oprire) VALUES (2, 4, 1); -- Buc
INSERT INTO Ruta_Statie (ruta_id, statie_id, ordine_oprire) VALUES (2, 5, 2); -- Ploiesti
INSERT INTO Ruta_Statie (ruta_id, statie_id, ordine_oprire) VALUES (3, 4, 1); -- Buc
INSERT INTO Ruta_Statie (ruta_id, statie_id, ordine_oprire) VALUES (3, 6, 2); -- Bv
INSERT INTO Ruta_Statie (ruta_id, statie_id, ordine_oprire) VALUES (4, 6, 1); -- Bv
INSERT INTO Ruta_Statie (ruta_id, statie_id, ordine_oprire) VALUES (4, 7, 2); -- Sibiu
INSERT INTO Ruta_Statie (ruta_id, statie_id, ordine_oprire) VALUES (4, 8, 3); -- Deva

-- AUTOBUZ & AUTOBUZ_DOTARE
INSERT INTO Autobuz (producator_id, nr_inmatriculare, marca, model, an_fabricatie, total_locuri) VALUES (1, 'B 101 BUS', 'Mercedes', 'Tourismo', 2022, 50);
INSERT INTO Autobuz (producator_id, nr_inmatriculare, marca, model, an_fabricatie, total_locuri) VALUES (2, 'BV 05 BUS', 'Setra', 'S 515', 2022, 55);
INSERT INTO Autobuz (producator_id, nr_inmatriculare, marca, model, an_fabricatie, total_locuri) VALUES (3, 'IS 99 BUS', 'Iveco', 'Magelys', 2022, 45);
INSERT INTO Autobuz (producator_id, nr_inmatriculare, marca, model, an_fabricatie, total_locuri) VALUES (4, 'B 777 BUS', 'Isuzu', 'Turquoise', 2022, 30);
INSERT INTO Autobuz (producator_id, nr_inmatriculare, marca, model, an_fabricatie, total_locuri) VALUES (5, 'CJ 22 BUS', 'Volvo', '9700', 2022, 52);

INSERT INTO Autobuz_Dotare (autobuz_id, dotare_id) VALUES (1,1); INSERT INTO Autobuz_Dotare (autobuz_id, dotare_id) VALUES (1,2);
INSERT INTO Autobuz_Dotare (autobuz_id, dotare_id) VALUES (2,2); INSERT INTO Autobuz_Dotare (autobuz_id, dotare_id) VALUES (2,4);
INSERT INTO Autobuz_Dotare (autobuz_id, dotare_id) VALUES (3,1); INSERT INTO Autobuz_Dotare (autobuz_id, dotare_id) VALUES (3,3);
INSERT INTO Autobuz_Dotare (autobuz_id, dotare_id) VALUES (4,2); INSERT INTO Autobuz_Dotare (autobuz_id, dotare_id) VALUES (4,5);
INSERT INTO Autobuz_Dotare (autobuz_id, dotare_id) VALUES (5,1); INSERT INTO Autobuz_Dotare (autobuz_id, dotare_id) VALUES (5,2);

-- CURSE
INSERT INTO Cursa (ruta_id, autobuz_id, sofer_id, data_ora_plecare) VALUES (1, 1, 1, SYSTIMESTAMP);
INSERT INTO Cursa (ruta_id, autobuz_id, sofer_id, data_ora_plecare) VALUES (2, 2, 2, SYSTIMESTAMP + 1);
INSERT INTO Cursa (ruta_id, autobuz_id, sofer_id, data_ora_plecare) VALUES (3, 3, 3, SYSTIMESTAMP + 2);
INSERT INTO Cursa (ruta_id, autobuz_id, sofer_id, data_ora_plecare) VALUES (4, 4, 4, SYSTIMESTAMP + 3);
INSERT INTO Cursa (ruta_id, autobuz_id, sofer_id, data_ora_plecare) VALUES (5, 5, 5, SYSTIMESTAMP + 4);

-- PRET_SEGMENT
INSERT INTO Pret_Segment (ruta_id, statie_plecare_id, statie_sosire_id, pret_baza) VALUES (1, 1, 2, 40); -- Iasi-Focsani
INSERT INTO Pret_Segment (ruta_id, statie_plecare_id, statie_sosire_id, pret_baza) VALUES (1, 2, 3, 30); -- Focsani-Buzau
INSERT INTO Pret_Segment (ruta_id, statie_plecare_id, statie_sosire_id, pret_baza) VALUES (1, 3, 4, 30); -- Buzau-Buc
INSERT INTO Pret_Segment (ruta_id, statie_plecare_id, statie_sosire_id, pret_baza) VALUES (1, 1, 4, 85); -- Iasi-Buc (tot)
INSERT INTO Pret_Segment (ruta_id, statie_plecare_id, statie_sosire_id, pret_baza) VALUES (2, 4, 5, 25); -- Buc-Ploiesti
INSERT INTO Pret_Segment (ruta_id, statie_plecare_id, statie_sosire_id, pret_baza) VALUES (3, 4, 6, 60); -- Buc-Bv
INSERT INTO Pret_Segment (ruta_id, statie_plecare_id, statie_sosire_id, pret_baza) VALUES (4, 6, 7, 35); -- Bv-Sibiu
INSERT INTO Pret_Segment (ruta_id, statie_plecare_id, statie_sosire_id, pret_baza) VALUES (4, 7, 8, 30); -- Sibiu-Deva
INSERT INTO Pret_Segment (ruta_id, statie_plecare_id, statie_sosire_id, pret_baza) VALUES (4, 6, 8, 55); -- Bv-Deva (tot)
INSERT INTO Pret_Segment (ruta_id, statie_plecare_id, statie_sosire_id, pret_baza) VALUES (5, 4, 7, 45); -- Segment extra

-- REZERVARI
INSERT INTO Rezervare (client_id, cursa_id, nr_loc, statie_plecare_id, statie_sosire_id, pret) VALUES (1, 1, 5, 1, 2, 40); -- Iasi-Focsani
INSERT INTO Rezervare (client_id, cursa_id, nr_loc, statie_plecare_id, statie_sosire_id, pret) VALUES (2, 1, 5, 2, 3, 30); -- Focsani-Buzau
INSERT INTO Rezervare (client_id, cursa_id, nr_loc, statie_plecare_id, statie_sosire_id, pret) VALUES (3, 1, 5, 3, 4, 30); -- Buzau-Buc
INSERT INTO Rezervare (client_id, cursa_id, nr_loc, statie_plecare_id, statie_sosire_id, pret) VALUES (4, 1, 10, 1, 4, 85); -- Iasi-Buc (tot)
INSERT INTO Rezervare (client_id, cursa_id, nr_loc, statie_plecare_id, statie_sosire_id, pret) VALUES (5, 2, 1, 4, 5, 25); -- Buc-Ploiesti
INSERT INTO Rezervare (client_id, cursa_id, nr_loc, statie_plecare_id, statie_sosire_id, pret) VALUES (1, 3, 2, 4, 6, 60); 
INSERT INTO Rezervare (client_id, cursa_id, nr_loc, statie_plecare_id, statie_sosire_id, pret) VALUES (2, 4, 3, 6, 7, 35);
INSERT INTO Rezervare (client_id, cursa_id, nr_loc, statie_plecare_id, statie_sosire_id, pret) VALUES (3, 4, 3, 7, 8, 30);
INSERT INTO Rezervare (client_id, cursa_id, nr_loc, statie_plecare_id, statie_sosire_id, pret) VALUES (4, 4, 10, 6, 8, 55);
INSERT INTO Rezervare (client_id, cursa_id, nr_loc, statie_plecare_id, statie_sosire_id, pret) VALUES (5, 5, 20, 4, 7, 45);

-- MENTENANTE
INSERT INTO Mentenanta (autobuz_id, tip_mentenanta, descriere, data_inceput, data_sfarsit, cost, efectuata_de) 
VALUES (1, 'Revizie Periodica', 'Schimb ulei, filtre si verificare sistem franare', TO_DATE('2025-10-10', 'YYYY-MM-DD'), TO_DATE('2025-10-11', 'YYYY-MM-DD'), 1250.50, 'Mercedes Service Bucuresti');
INSERT INTO Mentenanta (autobuz_id, tip_mentenanta, descriere, data_inceput, data_sfarsit, cost, efectuata_de) 
VALUES (2, 'Inlocuire Anvelope', 'Set anvelope iarna noi Michelin', TO_DATE('2025-11-05', 'YYYY-MM-DD'), TO_DATE('2025-11-05', 'YYYY-MM-DD'), 4200.00, 'Euromaster Brasov');
INSERT INTO Mentenanta (autobuz_id, tip_mentenanta, descriere, data_inceput, data_sfarsit, cost, efectuata_de) 
VALUES (3, 'Reparatie AC', 'Reincarcare freon si curatare instalatie climatizare', TO_DATE('2025-06-15', 'YYYY-MM-DD'), TO_DATE('2025-06-15', 'YYYY-MM-DD'), 450.00, 'AutoCool Iasi');
INSERT INTO Mentenanta (autobuz_id, tip_mentenanta, descriere, data_inceput, data_sfarsit, cost, efectuata_de) 
VALUES (4, 'Inspectie ITP', 'Inspectie tehnica periodica obligatorie', TO_DATE('2025-08-20', 'YYYY-MM-DD'), TO_DATE('2025-08-20', 'YYYY-MM-DD'), 250.00, 'Statia ITP Bucuresti');
INSERT INTO Mentenanta (autobuz_id, tip_mentenanta, descriere, data_inceput, data_sfarsit, cost, efectuata_de) 
VALUES (5, 'Reparatie Motor', 'Inlocuire injectoare si verificare pompa combustibil', TO_DATE('2025-09-01', 'YYYY-MM-DD'), TO_DATE('2025-09-03', 'YYYY-MM-DD'), 3800.00, 'Volvo Truck Center Cluj');

-- PLATI
INSERT INTO Plata (rezervare_id, suma, metoda_plata, status) VALUES (1, 40.00, 'Card Online', 'succes');
INSERT INTO Plata (rezervare_id, suma, metoda_plata, status) VALUES (2, 30.00, 'Card Online', 'succes');
INSERT INTO Plata (rezervare_id, suma, metoda_plata, status) VALUES (3, 30.00, 'Cash', 'succes');
INSERT INTO Plata (rezervare_id, suma, metoda_plata, status) VALUES (4, 85.00, 'Card Online', 'succes');
INSERT INTO Plata (rezervare_id, suma, metoda_plata, status) VALUES (5, 25.00, 'Transfer', 'succes');

